"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useSnap=void 0;var konva_1=__importDefault(require("konva")),GUIDELINE_OFFSET=5;function getObjectSnappingEdges(e){var t=e.getClientRect(),n=e.getAbsolutePosition();return{vertical:[{guide:t.x,offset:n.x-t.x,snap:"start"},{guide:t.x+t.width/2,offset:n.x-t.x-t.width/2,snap:"center"},{guide:t.x+t.width,offset:n.x-t.x-t.width,snap:"end"}],horizontal:[{guide:t.y,offset:n.y-t.y,snap:"start"},{guide:t.y+t.height/2,offset:n.y-t.y-t.height/2,snap:"center"},{guide:t.y+t.height,offset:n.y-t.y-t.height,snap:"end"}]}}function getGuides(e,t){var n=[],i=[];e.vertical.forEach((function(e){t.vertical.forEach((function(t){var i=Math.abs(e-t.guide);i<GUIDELINE_OFFSET&&n.push({lineGuide:e,diff:i,snap:t.snap,offset:t.offset})}))})),e.horizontal.forEach((function(e){t.horizontal.forEach((function(t){var n=Math.abs(e-t.guide);n<GUIDELINE_OFFSET&&i.push({lineGuide:e,diff:n,snap:t.snap,offset:t.offset})}))}));var a=[],r=n.sort((function(e,t){return e.diff-t.diff}))[0],o=i.sort((function(e,t){return e.diff-t.diff}))[0];return r&&a.push(__assign({orientation:"V"},r)),o&&a.push(__assign(__assign({},o),{orientation:"H"})),a}function useSnap(e,t){if(void 0===t&&(t=!0),!t)return{onDragMove:function(){},onDragEnd:function(){}};var n=function(e){return e.hasName("element")||e.hasName("page-background")};return{onDragMove:function(t){t.target.getLayer().find(".guid-line").destroy();var i,a,r,o,s,u=getGuides((i=t.target,r=null===(a=e.current)||void 0===a?void 0:a.getStage(),o=[],s=[],r.find(n).each((function(e){if(e!==i){var t=e.getClientRect({skipShadow:!0,skipStroke:!0});o.push(t.x,t.x+t.width,t.x+t.width/2),s.push(t.y,t.y+t.height,t.y+t.height/2)}})),{vertical:o,horizontal:s}),getObjectSnappingEdges(t.target));if(u.length){!function(t){var n,i=null===(n=e.current)||void 0===n?void 0:n.getLayer();t.forEach((function(e){if("H"===e.orientation){var t=new konva_1.default.Line({points:[-6e3,e.lineGuide,6e3,e.lineGuide],stroke:"rgb(0, 161, 255)",strokeWidth:1,name:"guid-line",dash:[4,6]});i.add(t),i.batchDraw()}else if("V"===e.orientation){t=new konva_1.default.Line({points:[e.lineGuide,-6e3,e.lineGuide,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:1,name:"guid-line",dash:[4,6]});i.add(t),i.batchDraw()}}))}(u);var f=t.target.getAbsolutePosition();u.forEach((function(e){switch(e.snap){case"start":case"center":case"end":switch(e.orientation){case"V":f.x=e.lineGuide+e.offset;break;case"H":f.y=e.lineGuide+e.offset}}})),t.target.setAbsolutePosition(f)}},onDragEnd:function(e){var t=e.target.getLayer();t.find(".guid-line").destroy(),t.batchDraw()}}}exports.useSnap=useSnap;