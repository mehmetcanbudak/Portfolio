"use strict";var __makeTemplateObject=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__awaiter=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{l(a.next(e))}catch(e){o(e)}}function c(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((a=a.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),core_1=require("@blueprintjs/core"),styled_1=__importDefault(require("@emotion/styled")),image_1=require("../utils/image"),SectionContainer=styled_1.default.div(templateObject_1||(templateObject_1=__makeTemplateObject(["\n  width: 60px;\n  height: 60px;\n  padding: 5px;\n  text-align: center;\n  cursor: pointer;\n\n  &:hover,\n  &.active {\n    color: blue;\n  }\n"],["\n  width: 60px;\n  height: 60px;\n  padding: 5px;\n  text-align: center;\n  cursor: pointer;\n\n  &:hover,\n  &.active {\n    color: blue;\n  }\n"]))),SectionWrap=function(e){var t=e.children,n=e.name,a=e.onClick,r=e.active;return react_1.default.createElement(SectionContainer,{onClick:a,className:r?"active":""},react_1.default.createElement("div",null,t),react_1.default.createElement("div",{style:{paddingTop:"5px"}},n))},TextSection=function(e){var t=e.store;return react_1.default.createElement("div",null,react_1.default.createElement(core_1.Button,{style:{width:"100%",fontSize:"25px",marginBottom:"20px"},minimal:!0,onClick:function(){var e;null===(e=t.activePage)||void 0===e||e.addElement({type:"text",fontSize:125,text:"HEADER TEXT",fontFamily:"Roboto"})}},"Create HEADER"),react_1.default.createElement(core_1.Button,{style:{width:"100%",fontSize:"18px",marginBottom:"20px"},minimal:!0,onClick:function(){var e;null===(e=t.activePage)||void 0===e||e.addElement({type:"text",fontSize:90,text:"SUB HEADER TEXT"})}},"Create SUB HEADER"),react_1.default.createElement(core_1.Button,{style:{width:"100%",fontSize:"14px",marginBottom:"20px"},minimal:!0,onClick:function(){var e;null===(e=t.activePage)||void 0===e||e.addElement({type:"text",fontSize:80,text:"Body text"})}},"Create body text"))},SIZES=[["Instagram Post",1080,1080],["Instagram Story",1080,1920],["Instagram Ad",1080,1080],["Facebook Post",940,788],["Facebook Cover",851,315],["Facebook Ad",1200,628],["Youtube Thumbnail",1280,720],["Youtube Channel",2560,1440],["Full HD",1920,1080]],SizeSection=function(e){var t=e.store;return react_1.default.createElement("div",null,SIZES.map((function(e){var n=e[0],a=e[1],r=e[2];return react_1.default.createElement(core_1.Button,{key:n,style:{width:"100%",marginBottom:"20px"},minimal:!0,onClick:function(){t.setSize(a,r)}},n,react_1.default.createElement("span",{style:{fontSize:"0.7rem",paddingLeft:"10px"}},a," x ",r))})))},ImagesListContainer=styled_1.default.div(templateObject_2||(templateObject_2=__makeTemplateObject(["\n  height: 100%;\n  overflow: auto;\n"],["\n  height: 100%;\n  overflow: auto;\n"]))),ImageItem=styled_1.default.div(templateObject_3||(templateObject_3=__makeTemplateObject(["\n  width: calc(50% - 10px);\n  margin: 5px;\n  display: inline-box;\n  box-sizing: border-box;\n  height: 100px;\n\n  border-radius: 3px;\n  cursor: pointer;\n  background-size: cover;\n  background-position: center;\n"],["\n  width: calc(50% - 10px);\n  margin: 5px;\n  display: inline-box;\n  box-sizing: border-box;\n  height: 100px;\n\n  border-radius: 3px;\n  cursor: pointer;\n  background-size: cover;\n  background-position: center;\n"]))),ImagesRow=styled_1.default.div(templateObject_4||(templateObject_4=__makeTemplateObject(["\n  width: 50%;\n  float: left;\n"],["\n  width: 50%;\n  float: left;\n"]))),ImgWrapDiv=styled_1.default.div(templateObject_5||(templateObject_5=__makeTemplateObject(["\n  padding: 5px;\n  width: 100%;\n  &:hover .credit {\n    opacity: 1;\n  }\n"],["\n  padding: 5px;\n  width: 100%;\n  &:hover .credit {\n    opacity: 1;\n  }\n"]))),ImgContainerDiv=styled_1.default.div(templateObject_6||(templateObject_6=__makeTemplateObject(["\n  border-radius: 5px;\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 0 5px lightgrey;\n"],["\n  border-radius: 5px;\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 0 5px lightgrey;\n"]))),Img=styled_1.default.img(templateObject_7||(templateObject_7=__makeTemplateObject(["\n  width: 100%;\n  cursor: pointer;\n  display: block;\n"],["\n  width: 100%;\n  cursor: pointer;\n  display: block;\n"]))),CreditWrap=styled_1.default.div(templateObject_8||(templateObject_8=__makeTemplateObject(["\n  position: absolute;\n  bottom: 0px;\n  left: 0px;\n  font-size: 10px;\n  padding: 3px;\n  text-align: center;\n  background-color: rgba(255, 255, 255, 0.6);\n  width: 100%;\n  opacity: 0;\n"],["\n  position: absolute;\n  bottom: 0px;\n  left: 0px;\n  font-size: 10px;\n  padding: 3px;\n  text-align: center;\n  background-color: rgba(255, 255, 255, 0.6);\n  width: 100%;\n  opacity: 0;\n"]))),Image=function(e){var t=e.url,n=e.credit,a=e.onSelect;return react_1.default.createElement(ImgWrapDiv,{onClick:function(){a(t)}},react_1.default.createElement(ImgContainerDiv,null,react_1.default.createElement(Img,{src:t}),n&&react_1.default.createElement(CreditWrap,{className:"credit"},n)))},Images=function(e){var t=e.images,n=e.onSelect,a=e.getPreview,r=e.loadMore,o=e.getCredit,i=t.filter((function(e,t){return t%2==0})),c=t.filter((function(e,t){return t%2==1}));return react_1.default.createElement(ImagesListContainer,null,react_1.default.createElement(ImagesRow,null,i.map((function(e){return react_1.default.createElement(Image,{url:a(e),onSelect:function(){return n(e)},key:a(e),credit:o&&o(e)})}))),react_1.default.createElement(ImagesRow,null,c.map((function(e){return react_1.default.createElement(Image,{url:a(e),onSelect:function(){return n(e)},key:a(e),credit:o&&o(e)})}))),r&&react_1.default.createElement(core_1.Button,{style:{width:"100%",marginBottom:"20px"},minimal:!0,onClick:function(e){e.currentTarget.blur(),r()}},"Load more"))},timeout=0,ImagesSection=function(e){var t=e.store,n=react_1.default.useState([]),a=n[0],r=n[1],o=react_1.default.useRef(0),i=react_1.default.useRef("canvas"),c=react_1.default.useRef(),l=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,fetch("https://api.polotno.dev/api/get-unsplash?query="+i.current+"&page="+o.current+"&per_page=20")];case 1:return[4,n.sent().json()];case 2:return t=n.sent(),r(e?a.concat(t.results):t.results),[2]}}))}))},u=react_1.default.useCallback((function(e){o.current=1,i.current=e,clearTimeout(c.current),c.current=setTimeout((function(){l(!1)}),500)}),[]);return react_1.default.useEffect((function(){u("canvas")}),[]),react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement(core_1.InputGroup,{leftIcon:"search",placeholder:"Search...",onChange:function(e){u(e.target.value)},style:{marginBottom:"20px"}}),react_1.default.createElement(Images,{images:a,getPreview:function(e){return e.urls.small},onSelect:function(e){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,o;return __generator(this,(function(i){switch(i.label){case 0:return fetch("https://api.polotno.dev/api/download-unsplash?id="+e.id),[4,image_1.getImageSize(e.urls.small)];case 1:return n=i.sent(),a=n.width,r=n.height,null===(o=t.activePage)||void 0===o||o.addElement({type:"image",src:e.urls.regular,width:a,height:r}),[2]}}))}))},loadMore:function(){o.current+=1,l(!0)},getCredit:function(e){return react_1.default.createElement("span",null,"Photo by"," ",react_1.default.createElement("a",{href:"https://unsplash.com/@"+e.user.username+"?utm_source=polotno&utm_medium=referral"},e.user.name)," ","on"," ",react_1.default.createElement("a",{href:"https://unsplash.com/?utm_source=polotno&utm_medium=referral"},"Unsplash"))}}))},colors=["white","rgb(82, 113, 255)","rgb(255, 145, 77)","rgb(126, 217, 87)","rgb(255, 222, 89)"],BackgroundSection=function(e){var t=e.store,n=react_1.default.useState([]),a=n[0],r=n[1],o=react_1.default.useCallback((function(e){clearTimeout(timeout),timeout=setTimeout((function(){fetch("https://api.polotno.dev/api/get-unsplash?query="+e+"&per_page=20").then((function(e){return e.json()})).then((function(e){r(e.results)}))}),500)}),[]);return react_1.default.useEffect((function(){o("pattern")}),[]),react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement(ImagesListContainer,null,react_1.default.createElement("div",null,colors.map((function(e){return react_1.default.createElement("div",{key:e,style:{display:"inline-block",width:"30px",height:"30px",backgroundColor:e,margin:"5px",borderRadius:"2px",boxShadow:"0 0 2px grey"},onClick:function(){var n;null===(n=t.activePage)||void 0===n||n.set({background:e})}})}))),react_1.default.createElement(Images,{images:a,getPreview:function(e){return e.urls.small},onSelect:function(e){return __awaiter(void 0,void 0,void 0,(function(){var n;return __generator(this,(function(a){return fetch("https://api.polotno.dev/api/download-unsplash?id="+e.id),null===(n=t.activePage)||void 0===n||n.set({background:e.urls.regular}),[2]}))}))},getCredit:function(e){return react_1.default.createElement("span",null,"Photo by"," ",react_1.default.createElement("a",{href:"https://unsplash.com/@"+e.user.username+"?utm_source=polotno&utm_medium=referral"},e.user.name)," ","on"," ",react_1.default.createElement("a",{href:"https://unsplash.com/?utm_source=polotno&utm_medium=referral"},"Unsplash"))}})))};function svgToURL(e){return"data:image/svg+xml;base64,"+window.btoa(e)}var templateObject_1,templateObject_2,templateObject_3,templateObject_4,templateObject_5,templateObject_6,templateObject_7,templateObject_8,SvgSection=function(e){var t=e.store,n=react_1.default.useState([]),a=n[0],r=n[1];return react_1.default.useEffect((function(){__awaiter(void 0,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,fetch("https://api.polotno.dev/api/get-svgs")];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),r(e.items),[2]}}))}))}),[]),react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement(Images,{images:a,getPreview:function(e){return e.url},onSelect:function(e){return __awaiter(void 0,void 0,void 0,(function(){var n,a,r,o;return __generator(this,(function(i){switch(i.label){case 0:return[4,image_1.getImageSize(e.url)];case 1:return n=i.sent(),a=n.width,r=n.height,null===(o=t.activePage)||void 0===o||o.addElement({type:"svg",svgSource:e.url,width:a,height:r}),[2]}}))}))}}))};exports.default=mobx_react_lite_1.observer((function(e){var t=e.store,n=react_1.default.useState("images"),a=n[0],r=n[1];return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{style:{display:"flex",flexDirection:"column",borderRight:"1px solid lightgrey",paddingTop:"5px"}},react_1.default.createElement(SectionWrap,{active:"text"===a,name:"Text",onClick:function(){r("text")}},react_1.default.createElement(core_1.Icon,{icon:"font"})),react_1.default.createElement(SectionWrap,{active:"images"===a,name:"Images",onClick:function(){r("images")}},react_1.default.createElement(core_1.Icon,{icon:"media"})),react_1.default.createElement(SectionWrap,{active:"size"===a,name:"Resize",onClick:function(){r("size")}},react_1.default.createElement(core_1.Icon,{icon:"fullscreen"})),react_1.default.createElement(SectionWrap,{active:"svg"===a,name:"SVG",onClick:function(){r("svg")}},react_1.default.createElement(core_1.Icon,{icon:"polygon-filter"})),react_1.default.createElement(SectionWrap,{active:"background"===a,name:"Back ",onClick:function(){r("background")}},react_1.default.createElement(core_1.Icon,{icon:"layout-grid"}))),react_1.default.createElement("div",{style:{padding:"10px",width:"100%",height:"100%",borderRight:"1px solid lightgrey"}},"text"===a&&react_1.default.createElement(TextSection,{store:t}),"images"===a&&react_1.default.createElement(ImagesSection,{store:t}),"size"===a&&react_1.default.createElement(SizeSection,{store:t}),"svg"===a&&react_1.default.createElement(SvgSection,{store:t}),"background"===a&&react_1.default.createElement(BackgroundSection,{store:t})))}));